<!DOCTYPE html>

<html>

<head>
  <style>
    canvas {
      margin: auto;
      background-color: lightgrey;
      display: block;
    }

    body {
      background-color: darkslategray;
    }

  </style>
</head>

<body>
  <canvas id="myCanvas" width="1000" height="1000"></canvas>

  <script>
    //author Jeff Shepherd
    function start() {
      let fieldOfColor = [];
      let colorShiftID;
      let rowShiftID;

      buildCanvas(fieldOfColor);
      startTimers();

      function startTimers() {
        let step = getRandomNumber([1, 5]);
        let milliseconds = 300;

        startColorShift("blue", step);
        startRowShift();

        function startColorShift(color, step) {
          console.log(`${color} shift begun.`);
          colorShiftID = setInterval(() => {
            shiftColors(fieldOfColor, color, step);
          }, milliseconds);
        }

        function startRowShift() {
          console.log("Row shift begun.");
          rowShiftID = setInterval(() => {
            shiftRows(fieldOfColor);
          }, milliseconds);
        }

        function stopInterval(intervalID) {
          clearInterval(intervalID);
        }
      }
    }

    const canvas = document.getElementById("myCanvas");
    const context = canvas.getContext("2d");
    context.globalCompositeOperation = "source-over";

    const reds = Object.freeze(new ColorRange([200, 255], [0, 100], [0, 100]));
    const greens = Object.freeze(new ColorRange([0, 100], [200, 255], [0, 100]));
    const blues = Object.freeze(new ColorRange([0, 100], [0, 100], [200, 255]));
    const randomColors = Object.freeze(new ColorRange([0, 255], [0, 255], [0, 255]));

    function buildCanvas(fieldOfColor) {
      let rowMax = 10;
      let columnMax = 10;
      let height = 100;
      let width = 100;
      let x = 0;
      let y = 0;

      for (let i = 0; i < rowMax; i++) {
        //increment the y coord from 0 to 1000 in steps of 100
        x = 0; //return to left side of canvas
        if (i > 0) {
          y += 100;
        };
        for (let j = 0; j < columnMax; j++) {
          //increment the x coord from 0 to 1000 in steps of 100
          if (j > 0) {
            x += 100;
          };
          fieldOfColor.push(new ColorBlock(getRandomColor(blues), [x, y], [height, width]));
        }
      }
    }

    function shiftRows(anArray) {
      anArray.forEach(item => {
        item.incrementXCoord();
      });
    }

    function shiftColors(anArray, color, step) {
      anArray.forEach(item => {
        item.incrementColor(color, step);
      });
    }

    /*
     * params: color[3], coords[2], dimensions[2]
     * response: ColorBlock Object
     * description: ColorBlock constructor.
     */
    function ColorBlock(aColor, coords, dimensions) {
      this.coords = coords;
      this.dimensions = dimensions;
      this.red = aColor[0];
      this.green = aColor[1];
      this.blue = aColor[2];
      context.fillStyle = `rgb(${this.red}, ${this.green}, ${this.blue})`;
      //x coord, y coord, width, height
      context.fillRect(this.coords[0], this.coords[1], this.dimensions[0], this.dimensions[1])
    }

    ColorBlock.prototype.setRed = function (red) {
      this.red = red;
      if (this.red > 255) {
        this.red = 0;
      }
      if (this.red < 0) {
        this.red = 255;
      }
    }

    ColorBlock.prototype.setGreen = function (green) {
      this.green = green;
      if (this.green > 255) {
        this.green = 0;
      }
      if (this.green < 0) {
        this.green = 255;
      }
    }

    ColorBlock.prototype.setBlue = function (blue) {
      this.blue = blue;
      if (this.blue > 255) {
        this.blue = 0;
      }
      if (this.blue < 0) {
        this.blue = 255;
      }
    }

    /*
     * params: none
     * response: increments the x coord by 100
     * description: causes an apparent shift in colors from
     * left to right with wrap around.
     */
    ColorBlock.prototype.incrementXCoord = function () {
      xCoord = this.coords[0];
      xCoord = xCoord += 100;
      if (xCoord > 900) {
        xCoord = 0;
      }
      this.coords[0] = xCoord;
    }

    /*
     * params: color string and integer step
     * response: increments color values
     * description: changes color values
     */
    ColorBlock.prototype.incrementColor = function (aColor, step) {
      if (aColor = "red") {
        this.setRed(this.red + step);
        this.setGreen(this.green - step);
        this.setBlue(this.blue - step);

      } else if (aColor = "green") {
        this.setRed(this.red - step);
        this.setGreen(this.green + step);
        this.setBlue(this.blue - step);

      } else if (aColor = "blue") {
        this.setRed(this.red - step);
        this.setGreen(this.green - step);
        this.setBlue(this.blue + step);
      }
      //extract a function "redraw" with the following lines
      context.clearRect(this.coords[0], this.coords[1], this.dimensions[0], this.dimensions[1]);
      context.fillStyle = `rgb(${this.red}, ${this.green}, ${this.blue})`;
      context.fillRect(this.coords[0], this.coords[1], this.dimensions[0], this.dimensions[1]);
    };

    /*
     * params: three 2-element arrays
     * response: returns a colorSet object
     * description: color set constructor
     */
    function ColorRange(r, g, b) {
      this.red = r;
      this.green = g;
      this.blue = b;
    }

    /*
     * params: ColorRange object
     * response: returns a string formatted as an css rgb value
     * description: generates a rgb color value and formats
     * for use as a valid style color.
     */
    function getRandomColor(colorRange) {
      r = getRandomNumber(colorRange.red);
      g = getRandomNumber(colorRange.green);
      b = getRandomNumber(colorRange.blue);
      return [r, g, b];
    }

    /*
     * params: a two element array with two integers
     * response: returns a number between min and max
     * description: generates random number in a range
     */
    function getRandomNumber(range) {
      let max = range[1];
      let min = range[0];
      let diff = max - min;
      return Math.floor((Math.random() * diff) + min);
    }

    start();

  </script>
</body>

</html>
